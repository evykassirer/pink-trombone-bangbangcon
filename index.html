<html>

<head>
<title>Pink Trombone</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
</head>

<body style="margin: 0; padding: 0; background-color:white">

<form id="ipaForm">
  <input id="ipaInput" type="text" name="ipa"></input>
  <input id="ipaSubmitButton" type="submit">
</form>

<canvas id="tractCanvas" width="600" height="600"
style = "position: absolute; z-index: 1;  background-color:transparent; margin: 0; padding: 0;">
</canvas>
<canvas id="backCanvas" width="600" height="600"
style = "position: absolute; z-index: 0; background-color:transparent; margin: 0; padding: 0;">
</canvas>

<script type="text/javascript" src="./utils/math.js"></script>
<script type="text/javascript" src="./utils/perlin-and-simplex-noise.js"></script>
<script type="text/javascript" src="./utils/browser-detection.js"></script>
<script type="text/javascript" src="./utils/make-button.js"></script>
<script type="text/javascript" src="./utils/IPA-mappings.js"></script>

<script type="text/javascript" src="./config.js"></script>

<!-- The only order requirement is that globals is before all the /lib files and the lib files are before the index.js -->
<script type="text/javascript" src="./globals.js"></script>

<script type="text/javascript" src="./lib/ui.js"></script>
<script type="text/javascript" src="./lib/audio-system.js"></script>
<script type="text/javascript" src="./lib/glottis.js"></script>
<script type="text/javascript" src="./lib/tract.js"></script>
<script type="text/javascript" src="./lib/tract-ui.js"></script>

<script type="text/javascript" src="./index.js"></script>
<script type="text/javascript" src="./utils/ipa-mappings.js"></script>

<script type="text/javascript">
// TODO move this to a file :p
const form = document.getElementById('ipaForm');
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
async function simulateCharacter(ipaText, index) {
  if (index === ipaText.length) {
    UI.setVoice(false);
    // weird lag in turning voice off (and on?) so i'll add this for now
    await sleep(200);
    UI.removeSimulatedTouches();
    UI.handleTouches();
    return;
  }
  UI.addSimulatedTouch(IPAMappings[ipaText[index]])
  await sleep(200);
  simulateCharacter(ipaText, index+1)
}
form.onsubmit = function(e){
  e.preventDefault();
  ipaText = e.target[0].value;
  simulateCharacter(ipaText, 0);
};
</script>

</body>
</html>
